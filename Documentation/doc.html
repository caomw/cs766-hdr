<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Ke Ma" />
  <meta name="author" content="Christopher Bodden" />
  <title>CS 766 - HDR Project Documentation - CS 766 - HDR Project Documentation</title>
  <style type="text/css">code{white-space: pre;}</style>
  <link rel="stylesheet" href="readme.css" type="text/css" />
</head>
<body>
<div id="header">
<h1 class="title">CS 766 - HDR Project Documentation</h1>
<h2 class="author">Ke Ma</h2>
<h2 class="author">Christopher Bodden</h2>
<h3 class="date">2/19/2015</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#welcome-to-the-cs766-hdr-wiki">Welcome to the cs766-hdr wiki!</a><ul>
<li><a href="#links">Links:</a></li>
<li><a href="#assignment-description">Assignment Description:</a></li>
<li><a href="#features">Features:</a><ul>
<li><a href="#basic-features">Basic Features:</a></li>
<li><a href="#bonus-features">“Bonus” Features:</a></li>
</ul></li>
<li><a href="#results">Results</a><ul>
<li><a href="#friday-night"><em>Friday Night</em></a></li>
<li><a href="#reproducing-our-results">Reproducing Our Results</a></li>
<li><a href="#findings">Findings</a></li>
</ul></li>
<li><a href="#using-the-gui">Using the GUI</a><ul>
<li><a href="#starting-the-gui">Starting the GUI</a></li>
<li><a href="#loading-images">Loading Images</a></li>
<li><a href="#image-alignment">Image Alignment</a></li>
<li><a href="#recovering-the-response-curves-and-producing-a-radiance-map">Recovering the Response Curves and Producing a Radiance Map</a></li>
<li><a href="#tone-mapping">Tone Mapping</a></li>
<li><a href="#pick-settings">Pick Settings</a></li>
<li><a href="#saving-hdrfinal-images">Saving HDR/Final Images</a></li>
</ul></li>
<li><a href="#function-descriptions">Function Descriptions</a></li>
<li><a href="#other-files">Other Files</a></li>
<li><a href="#credits">Credits</a></li>
<li><a href="#references">References</a></li>
</ul></li>
</ul>
</div>
<h1 id="welcome-to-the-cs766-hdr-wiki">Welcome to the cs766-hdr wiki!</h1>
<p>Here we will describe our tool and results in detail.</p>
<h2 id="links">Links:</h2>
<ul>
<li>Repository: <a href="https://github.com/cbod/cs766-hdr" class="uri">https://github.com/cbod/cs766-hdr</a></li>
<li>Wiki: <a href="https://github.com/cbod/cs766-hdr/wiki" class="uri">https://github.com/cbod/cs766-hdr/wiki</a></li>
</ul>
<h2 id="assignment-description">Assignment Description:</h2>
<p>High dynamic range (HDR) images have much larger dynamic range than traditional images’ 256 brightness levels. In addition, they correspond linearly to physical irradiance values of the scene. Hence, they have many applications in vision. In this project, we implement algorithms to assemble an HDR image from several low dynamic range images.</p>
<h2 id="features">Features:</h2>
<p>This is a brief description of our implementation. More details can be found in the other pages of the wiki.</p>
<h3 id="basic-features">Basic Features:</h3>
<ul>
<li>Debevec’s Method for HDR reconstruction</li>
<li>Reinhard’s tone mapping algorithm</li>
<li>Simple Gamma Compression tone mapping</li>
</ul>
<h3 id="bonus-features">“Bonus” Features:</h3>
<ul>
<li>Ward’s MTB image alignment algorithm</li>
<li>Drago et al. tone mapping algorithm</li>
<li>Durand et al. tone mapping algorithm</li>
<li>GUI to pipeline the image recreation and expose all functions implemented</li>
</ul>
<h2 id="results">Results</h2>
<h3 id="friday-night"><em>Friday Night</em></h3>
<p>Our final image we call <em>Friday Night</em> mainly because we took it on Friday evening. The image features an interesting scene that is great for HDR. The capitol building and street lights are very bright against the dark sky. They also wash out the finer details in the buildings. HDR allows us to preserve these features and present a striking scene.</p>
<div class="figure">
<img src="images/FridayNight-Durand.jpg" alt="Sample Output" />
<p class="caption">Sample Output</p>
</div>
<h3 id="reproducing-our-results">Reproducing Our Results</h3>
<ol style="list-style-type: decimal">
<li>Load the LDR images: <em>FridayNight-x.jpg</em></li>
<li>Select <em>FridayNight-ExpTime.txt</em></li>
<li>Recover the response curve and radiance map</li>
<li>Tone map with Durand at contrast set to 6</li>
</ol>
<p><strong>Post Processing:</strong></p>
<p>The only post processing we used was resizing the final image because our original image was taken at 18 megapixels.</p>
<h3 id="findings">Findings</h3>
<p>We found that the best tone mapping algorithm that we implemented was Durand followed by Drago. Both of these produce dramatic, vivid colors. However, Durand tends to preserve more of the finer details. Reinhard, gamma compression, and the built-in MATLAB method all produce less interesting results. The built-in MATLAB method and gamma compression are washed out, while the Reinhard method produces less interesting colors.</p>
<h2 id="using-the-gui">Using the GUI</h2>
<p>To make working with our functions easier, we’ve implemented a simple GUI that streamlines the process and visually displays the results of image operations. Users can open a series of LDR images then align the images, recover the response functions, build the radiance map, and tone map to produce a final result. Or the users can directly open a .hdr file and tone map to produce a final result.</p>
<h3 id="starting-the-gui">Starting the GUI</h3>
<p>Simple run the file <em>hdr_gui.m</em></p>
<h3 id="loading-images">Loading Images</h3>
<p>We provide 2 methods to produce radiance map: 1) from a series of LDR images or 2) from a .hdr file</p>
<h4 id="using-a-series-of-ldr-images">Using a series of LDR Images</h4>
<ol style="list-style-type: decimal">
<li>Select Open Files -&gt; Load LDR Images.</li>
<li>A dialog will open for you to select all of the LDR images.</li>
<li>A second dialog will open to select the .txt file with image exposure times. (The format is shown in the <em>example_exposure_time.txt</em>.)</li>
<li>Click any of the loaded images to display the enlarged image in a new window.</li>
</ol>
<div class="figure">
<img src="images/open_LDRs.png" alt="Opened LDRs" />
<p class="caption">Opened LDRs</p>
</div>
<h4 id="using-a-.hdr-image">Using a .hdr Image</h4>
<ol style="list-style-type: decimal">
<li>Select Open Files -&gt; Open HDR.</li>
</ol>
<h3 id="image-alignment">Image Alignment</h3>
<p><em>This option is available after opening a series of LDR images successfully.</em></p>
<p>Simply click Image Tools -&gt; Align Images (MTB). This is an implementation of:</p>
<p>Greg Ward, <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.59.277">Fast Robust Image Registration for Compositing High Dynamic Range Photographs from Hand-Held Exposures</a>, jgt, 2003.</p>
<h3 id="recovering-the-response-curves-and-producing-a-radiance-map">Recovering the Response Curves and Producing a Radiance Map</h3>
<p><em>This option is available after opening a series of LDR images successfully.</em></p>
<p>Recovering the response curves and producing the radiance map is combined into a single operation. To perform this operation:</p>
<ol style="list-style-type: decimal">
<li>Select Image Tools -&gt; Recover Curves &amp; Radiance Map.</li>
<li>Click on either the displayed radiance map or any of the curves to enlarge the object in a new window.</li>
</ol>
<p><strong>Examples:</strong></p>
<p>GUI After Recovering Response Curves &amp; Radiance Map:</p>
<div class="figure">
<img src="images/GUI_recover_curves.png" alt="After Operation" />
<p class="caption">After Operation</p>
</div>
<p>Enlarged Radiance Map:</p>
<div class="figure">
<img src="images/enlarged_rad_map.png" alt="Enlarged Radiance Map" />
<p class="caption">Enlarged Radiance Map</p>
</div>
<p>Enlarged Response Curve:</p>
<div class="figure">
<img src="images/enlarged_curve.png" alt="Enlarged Response Curve" />
<p class="caption">Enlarged Response Curve</p>
</div>
<h3 id="tone-mapping">Tone Mapping</h3>
<p><em>This option is available after recovering the radiance map from a series of LDR images successfully or opening a .hdr file.</em></p>
<p>We provide 5 tone mapping methods and parameter settings in the Image Tools -&gt; Tone Map menu. The following explains each option:</p>
<h3 id="pick-settings">Pick Settings</h3>
<p>This menu allows users to tune relevant tone mapping parameters for each specific algorithm. You must click ‘Apply’ to save the settings.</p>
<ol style="list-style-type: decimal">
<li>Select Image Tools -&gt; Tone Map -&gt; Settings.</li>
<li>Tune any parameter of interest.</li>
<li>Click ‘Apply’.</li>
</ol>
<div class="figure">
<img src="images/tonemap_settings.png" alt="Tone Mapping Settings" />
<p class="caption">Tone Mapping Settings</p>
</div>
<h4 id="durand-method">Durand Method</h4>
<p>This is an implementation of the method describe in:</p>
<p>Fredo Durand, Julie Dorsey, <a href="http://pages.cs.wisc.edu/~lizhang/courses/cs766-2012f/projects/hdr/DurandBilateral.pdf">Fast Bilateral Filtering for the Display of High Dynamic Range Images</a>, SIGGRAPH 2002.</p>
<h4 id="drago-method">Drago Method</h4>
<p>This is an implementation of the method describe in:</p>
<p>F. Drago, K. Myszkowski, T. Annen, N. Chiba, <a href="http://pages.cs.wisc.edu/~lizhang/courses/cs766-2012f/projects/hdr/Drago2003ALM.pdf">Adaptive Logarithmic Mapping for Displaying High Contrast Scenes</a>, Eurographics 2003.</p>
<h4 id="reinhard-method">Reinhard Method</h4>
<p>This is an implementation of the global operator method describe in:</p>
<p>Erik Reinhard, Kate Devlin, <a href="http://pages.cs.wisc.edu/~lizhang/courses/cs766-2012f/projects/hdr/Reinhard2005DRR.pdf">Dynamic Range Reduction Inspired by Photoreceptor Physiology</a>, IEEE TVCG 2005.</p>
<h4 id="gamma-compression">Gamma Compression</h4>
<p>This is an implementation of a simple gamma compression as described in class.</p>
<h4 id="built-in-matlab-method">Built In MATLAB Method</h4>
<p>This simply uses the built-in MATLAB tonemap() method. This is provided mainly for reference.</p>
<h3 id="saving-hdrfinal-images">Saving HDR/Final Images</h3>
<p>Using the Save HDR/Final Image menu, we offer two option for saving working. The ability to save the radiance map as a .hdr file and to save the final tone mapped image.</p>
<h4 id="saving-.hdr-files">Saving .hdr Files</h4>
<p><em>This option is available after recovering the radiance map from a series of LDR images successfully or opening a .hdr file.</em></p>
<ol style="list-style-type: decimal">
<li>Select Save HDR/Final Image -&gt; Save HDR</li>
<li>Select the .hdr file destination and name.</li>
<li>Click Save</li>
</ol>
<h4 id="saving-final-images">Saving Final Images</h4>
<p><em>This option is available after tone mapping a radiance map.</em></p>
<ol style="list-style-type: decimal">
<li>Select Save HDR/Final Image -&gt; Save Final Image</li>
<li>Select the image destination and name.</li>
<li>Click Save</li>
</ol>
<h2 id="function-descriptions">Function Descriptions</h2>
<p>Below provide basic descriptions of our functions.</p>
<h4 id="alignmtb.m">alignMTB.m</h4>
<p><code>function alignedImgs = alignMTB(imgs, offsetRange)</code></p>
<p>Inputs:</p>
<ul>
<li>imgs: a vector of the original RGB images (an image is 3D object, width x height x color channels)</li>
<li>offsetRange: offset level setting parameter</li>
</ul>
<p>Outputs:</p>
<ul>
<li>alignedImgs: a vector of the aligned images</li>
</ul>
<h4 id="gsolve.m">gSolve.m</h4>
<p><code>function [g,lE] = gSolve(Z,B,l,w)</code></p>
<p>Inputs:</p>
<ul>
<li>Z: the image (a single channel)</li>
<li>B: the natural log exposure time values (delta t)</li>
<li>l: smoothing parameter (lambda)</li>
<li>w: the weighting matrix</li>
</ul>
<p>Outputs:</p>
<ul>
<li>g: the inverse of f function (response curve)</li>
<li>lE: the natural log exposure values</li>
</ul>
<h4 id="hdr_gui.m">hdr_gui.m</h4>
<p><code>function varargout = hdr_gui(varargin)</code></p>
<p>This function launches the main GUI window. It is not meant to be called programatically! Please run this as the main script in MATLAB.</p>
<h4 id="loadimages.m">loadImages.m</h4>
<p><code>function imgs = loadImages(imgFiles)</code></p>
<p>Inputs:</p>
<ul>
<li>imgFiles: a vector of image filenames to load</li>
</ul>
<p>Outputs:</p>
<ul>
<li>imgs: a vector of images</li>
</ul>
<h4 id="makeradmap.m">makeRadmap.m</h4>
<p><code>function [radmap, rG, gG, bG, rPxVals, gPxVals, bPxVals, rLgExps, gLgExps, bLgExps] = makeRadmap(imgs,expTimes,smoothness)</code></p>
<p>Inputs:</p>
<ul>
<li>imgs: a vector of images</li>
<li>expTimes: a vector of exposure time (not log exposure times!)</li>
<li>smoothness: smoothing parameter for response curve (lambda)</li>
</ul>
<p>Outputs:</p>
<ul>
<li>radmap: the radiance map for the HDR image</li>
<li>rG: the inverse of f function (response curve) for the red channel</li>
<li>gG: the inverse of f function (response curve) for the green channel</li>
<li>bG: the inverse of f function (response curve) for the blue channel</li>
<li>rPxVals: the sampled (unsmoothed) response pixel values for the red channel</li>
<li>gPxVals: the sampled (unsmoothed) response pixel values for the green channel</li>
<li>bPxVals: the sampled (unsmoothed) response pixel values for the blue channel</li>
<li>rLgExps: the natural log exposure values for the red channel</li>
<li>gLgExps: the natural log exposure values for the green channel</li>
<li>bLgExps: the natural log exposure values for the blue channel</li>
</ul>
<h4 id="mergeexps.m">mergeExps.m</h4>
<p><code>function E = mergeExps(Z,B,g,w)</code></p>
<p>Inputs:</p>
<ul>
<li>Z: the image (a single channel)</li>
<li>B: the natural log exposure time values (delta t)</li>
<li>g: the response curve function for this channel</li>
<li>w: the weighting matrix</li>
</ul>
<p>Outputs:</p>
<ul>
<li>E: the merged image for this color channel</li>
</ul>
<h4 id="samplepxs.m">samplePxs.m</h4>
<p><code>function Z = samplePxs(imgs)</code></p>
<p>Inputs:</p>
<ul>
<li>imgs: a vector of images for a single color channel</li>
</ul>
<p>Outputs:</p>
<ul>
<li>Z: a matrix of the pixel values in all of the images at randomly sampled pixel locations</li>
</ul>
<h4 id="tonemapbasic.m-reinhard-global-tone-mapping">toneMapBasic.m (Reinhard global tone mapping)</h4>
<p><code>function [image] = toneMapBasic(radMap, a)</code></p>
<p>Inputs:</p>
<ul>
<li>radMap: the radiance map to tone map</li>
<li>a: a tuning parameter for brightness (steps go: 0.09, 0.18, 0.36, 0.72)</li>
</ul>
<p>Outputs:</p>
<ul>
<li>image: the LDR tone mapped image</li>
</ul>
<h4 id="tonemapdrago.m">toneMapDrago.m</h4>
<p><code>function [image] = toneMapDrago(radMap, b)</code></p>
<p>Inputs:</p>
<ul>
<li>radMap: the radiance map to tone map</li>
<li>b: a tuning parameter for bias (range: 0.7 - 1.0)</li>
</ul>
<p>Outputs:</p>
<ul>
<li>image: the LDR tone mapped image</li>
</ul>
<h4 id="tonemapdurand.m">toneMapDurand.m</h4>
<p><code>function image = toneMapDurand(radmap, contrast)</code></p>
<p>Inputs:</p>
<ul>
<li>radmap: the radiance map to tone map</li>
<li>contrast: a tuning parameter for image contrast</li>
</ul>
<p>Outputs:</p>
<ul>
<li>image: the LDR tone mapped image</li>
</ul>
<h4 id="tonemapgamma.m-simple-gamma-compression">toneMapGamma.m (simple gamma compression)</h4>
<p><code>function [image] = toneMapGamma(radMap, gamma)</code></p>
<p>Inputs:</p>
<ul>
<li>radMap: the radiance map to tone map</li>
<li>gamma: a tuning parameter for the gamma value</li>
</ul>
<p>Outputs:</p>
<ul>
<li>image: the LDR tone mapped image</li>
</ul>
<h2 id="other-files">Other Files</h2>
<p>Some other files that are not meant to be used functionally, but are either needed for the GUI or were used for testing.</p>
<h4 id="enlargeimage.m"><em>enlargeImage.m</em></h4>
<p>This function is simply a helper to allow enlarging an image when clicked.</p>
<h4 id="tone_map_settings.m"><em>tone_map_settings.m</em></h4>
<p>Launches the tone map settings menu.</p>
<h4 id="hdr_gui.fig"><em>hdr_gui.fig</em></h4>
<p>The MATLAB figure for the main program GUI.</p>
<h4 id="tone_map_settings.fig"><em>tone_map_settings.fig</em></h4>
<p>The MATLAB figure for the tone map settings menu.</p>
<h4 id="testscriptsalignmtb_test.m"><em>TestScripts\alignMTB_test.m</em></h4>
<p>A script we used to test the MTB alignment method.</p>
<h4 id="testscriptsgsolve_test.m"><em>TestScripts\gSolve_test.m</em></h4>
<p>A script we used to test the solver method for recovering response curves.</p>
<h4 id="testscriptsmakeradmap_test.m"><em>TestScripts\makeRadmap_test.m</em></h4>
<p>A script we used to test the radiance map creation method.</p>
<h4 id="testscriptsmergeexps_test.m"><em>TestScripts\mergeExps_test.m</em></h4>
<p>A script we used to test the exposure merging method.</p>
<h4 id="testscriptstonemap_test.m"><em>TestScripts\toneMap_test.m</em></h4>
<p>A script we used to test the various tone mapping methods.</p>
<h2 id="credits">Credits</h2>
<p>Below is a break down of the work description. We worked together on taking the images and also helped fix some of each other’s bugs!</p>
<h4 id="ke-ma">Ke Ma</h4>
<ul>
<li>Response Curve Solution</li>
<li>Radiance Map Creation</li>
<li>MTB Alignment</li>
<li>Durand Tone Mapping</li>
</ul>
<h4 id="christopher-bodden">Christopher Bodden</h4>
<ul>
<li>Drago Tone Mapping</li>
<li>Reinhart Tone Mapping</li>
<li>GUI</li>
<li>Documentation Wiki</li>
</ul>
<h2 id="references">References</h2>
<ol style="list-style-type: decimal">
<li>Paul E. Debevec, Jitendra Malik, <a href="http://vsingh-www.cs.wisc.edu/cs766-12/lec/debevec-siggraph97.pdf">Recovering High Dynamic Range Radiance Maps from Photographs</a>, SIGGRAPH 1997.</li>
<li>Greg Ward, <a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.59.277">Fast Robust Image Registration for Compositing High Dynamic Range Photographs from Hand-Held Exposures</a>, jgt, 2003.</li>
<li>Fredo Durand, Julie Dorsey, <a href="http://pages.cs.wisc.edu/~lizhang/courses/cs766-2012f/projects/hdr/DurandBilateral.pdf">Fast Bilateral Filtering for the Display of High Dynamic Range Images</a>, SIGGRAPH 2002.</li>
<li>F. Drago, K. Myszkowski, T. Annen, N. Chiba, <a href="http://pages.cs.wisc.edu/~lizhang/courses/cs766-2012f/projects/hdr/Drago2003ALM.pdf">Adaptive Logarithmic Mapping for Displaying High Contrast Scenes</a>, Eurographics 2003.</li>
<li>Erik Reinhard, Kate Devlin, <a href="http://pages.cs.wisc.edu/~lizhang/courses/cs766-2012f/projects/hdr/Reinhard2005DRR.pdf">Dynamic Range Reduction Inspired by Photoreceptor Physiology</a>, IEEE TVCG 2005.</li>
</ol>
<hr />
<p>&copy;2015 Ke Ma, Christopher Bodden</p>
</body>
</html>
